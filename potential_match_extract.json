{
   "processType":"DB_EXTRACT",
   "syncStageSchema":"openmrs_extract_stage_area",
   "originAppLocationCode":"all_zbz_sites",
   "syncRootDirectory":"/home/jorgeboane/application/eptssync/potential-match",
   "automaticStart":true,
   "resumable":true,
   "appsInfo":[
      {
         "applicationCode":"main",
         "connInfo":{
            "dataBaseUserName":"root",
            "dataBaseUserPassword":"#eIPDB_123#",
            "connectionURI":"jdbc:mysql://localhost:53307/openmrs_fgh_central?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true",
            "driveClassName":"com.mysql.cj.jdbc.Driver"
         }
      },
      {
         "applicationCode":"destination",
         "connInfo":{
            "dataBaseUserName":"root",
            "dataBaseUserPassword":"#eIPDB_123#",
            "connectionURI":"jdbc:mysql://localhost:53307/openmrs_potential_match?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true",
            "driveClassName":"com.mysql.cj.jdbc.Driver"
         }
      }
   ],
   "operations":[
      {
         "operationType":"DB_EXTRACT",
         "maxRecordPerProcessing":2500,
         "maxSupportedEngines":24,
         "minRecordsPerEngine":500,
         "disabled":false,
         "processingMode":"sequencial"
      }
   ],
   "etlItemConfiguration":[
      {
         "srcConf":{
            "tableName":"person",
            "tableAlias":"person_1",
            "extraConditionForExtract":"not exists (select 1 from openmrs_potential_match.person dst_  where dst_.person_id = person_1.person_id)",
            "selfJoinTables":[
               {
                  "tableName":"patient_potential_match",
                  "joinType":"LEFT",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"person_Id"
                     }
                  ]
               },
               {
                  "tableName":"users",
                  "joinType":"LEFT",
                  "joinFields":[
                     {
                        "srcField":"person_id",
                        "dstField":"person_Id"
                     }
                  ]
               },
               {
                  "tableName":"relationship",
                  "tableAlias":"relationship_1",
                  "joinType":"LEFT",
                  "joinExtraCondition":"exists (select 1 from patient_potential_match where relationship_1.person_a = patient_potential_match.patient_id)",
                  "joinFields":[
                     {
                        "srcField":"person_a",
                        "dstField":"person_Id"
                     }
                  ]
               },
               {
                  "tableName":"relationship",
                  "tableAlias":"relationship_2",
                  "joinType":"LEFT",
                  "joinExtraCondition":"exists (select 1 from patient_potential_match inner join relationship relationship_3 on patient_potential_match.patient_id = relationship_3.person_a where relationship_2.relationship_id = relationship_3.relationship_id)",
                  "joinFields":[
                     {
                        "srcField":"person_b",
                        "dstField":"person_Id"
                     }
                  ]
               },
               {
                  "tableName":"provider",
                  "joinType":"LEFT",
                  "joinFields":[
                     {
                        "srcField":"person_id",
                        "dstField":"person_Id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },

      {
         "srcConf":{
            "tableName":"users",
            "parents":[
               {
                  "tableName":"person",
                  "defaultValueDueInconsistency":1
               },
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"patient",
	    "tableAlias": "patient_1",
            "extraConditionForExtract":"not exists (select 1 from openmrs_potential_match.patient dst_  where dst_.patient_id = patient_1.patient_id)",
            "selfJoinTables":[
               {
                  "tableName":"patient_potential_match",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ],
                  "joinType":"INNER"
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"location",
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"patient_program",
            "extraConditionForExtract":"patient_program.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.patient",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ],
            "observationDateFields":[
               "date_changed",
               "date_voided"
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"person_address",
            "extraConditionForExtract":"person_address.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.person",
                  "joinFields":[
                     {
                        "srcField":"person_id",
                        "dstField":"person_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ],
            "observationDateFields":[
               "date_changed",
               "date_voided"
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"person_attribute",
            "extraConditionForExtract":"person_attribute.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.person",
                  "joinFields":[
                     {
                        "srcField":"person_id",
                        "dstField":"person_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"person"
               },
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"person_name",
            "extraConditionForExtract":"person_name.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.person",
                  "joinFields":[
                     {
                        "srcField":"person_id",
                        "dstField":"person_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"relationship",
            "extraConditionForExtract":"relationship.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"patient_potential_match",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"person_a"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      
      {
         "srcConf":{
            "tableName":"patient_identifier",
            "extraConditionForExtract":"patient_identifier.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.patient",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ],
            "observationDateFields":[
               "date_changed",
               "date_voided"
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"patient_state",
            "extraConditionForExtract":"patient_state.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.patient_program",
                  "joinFields":[
                     {
                        "srcField":"patient_program_id",
                        "dstField":"patient_program_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"visit",
            "extraConditionForExtract":"visit.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.patient",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"visit_attribute",
            "extraConditionForExtract":"visit_attribute.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.visit",
                  "joinFields":[
                     {
                        "srcField":"visit_id",
                        "dstField":"visit_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"provider",
	    "tableAlias": "provider_1",
            "extraConditionForExtract":"not exists (select 1 from openmrs_potential_match.provider where provider_1.provider_id = provider.provider_id)",
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ],
            "observationDateFields":[
               "date_changed",
               "date_retired"
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"encounter",
            "extraConditionForExtract":"encounter.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"patient_potential_match",
		  "joinType": "INNER",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ]
               },
               {
                  "tableName":"openmrs_potential_match.visit",
		  "joinType": "INNER",
                  "joinFields":[
                     {
                        "srcField":"visit_id",
                        "dstField":"visit_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"encounter_provider",
	    "tableAlias":"encounter_provider_77",
            "extraConditionForExtract":"encounter_provider_77.voided = 0 and not exists (select 1 from openmrs_potential_match.encounter_provider dst where dst.uuid = encounter_provider_77.uuid)",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.encounter",
                  "joinFields":[
                     {
                        "srcField":"encounter_id",
                        "dstField":"encounter_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"orders",
            "extraConditionForExtract":"orders.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.encounter",
                  "joinFields":[
                     {
                        "srcField":"patient_id",
                        "dstField":"patient_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      },
      {
         "srcConf":{
            "tableName":"obs",
            "extraConditionForExtract":"obs.voided = 0",
            "selfJoinTables":[
               {
                  "tableName":"openmrs_potential_match.encounter",
                  "joinFields":[
                     {
                        "srcField":"encounter_id",
                        "dstField":"encounter_id"
                     }
                  ]
               }
            ],
            "parents":[
               {
                  "tableName":"users",
                  "defaultValueDueInconsistency":1
               }
            ]
         }
      }
   ]
}
